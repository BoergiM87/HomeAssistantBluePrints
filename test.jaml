blueprint:
  name: Z2M IKEA On Off and dimming Lights
  description: Blueprint for IKEA Remote Controls (e.g., e1743, e1744) using Zigbee2MQTT
  domain: automation
  source_url: https://github.com/BoergiM87/HomeAssistantBluePrints/blob/main/test.jaml
  input:
    remote_topic:
      name: Zigbee2MQTT Remote Topic
      description: The MQTT topic of your IKEA remote (e.g., "zigbee2mqtt/kitchen_remote")
      selector:
        text: {}
    lights:
      name: Lights
      description: Light(s) to control when using default light actions
      default:
        entity_id: none
      selector:
        entity:
          domain:
          - light
          multiple: false
    helper_transition_switch:
      name: Helper - Transition time in seconds for switching on / off
      description: Transition time in seconds for switching on / off (0.0-10.0)
      default: 1
      selector:
        number:
          min: 0.0
          max: 10.0
          mode: box
          step: 0.5
    helper_step_up:
      name: Helper - brightness up step
      description: Step size for changing brightness up (0-20)
      default: 5
      selector:
        number:
          min: 0.0
          max: 20.0
          mode: box
          step: 1.0
    helper_step_down:
      name: Helper - brightness down step
      description: Step size for changing brightness down (0-20)
      default: -5
      selector:
        number:
          min: -20.0
          max: 0.0
          mode: box
          step: 1.0
    helper_transition_dim:
      name: Helper - Transition time for dimming up / down
      description: Transition time in seconds for dimming up / down. 0 makes visible
        steps. Greater than 0.1 makes it smoother. (0.0-10.0)
      default: 0.5
      selector:
        number:
          min: 0.0
          max: 10.0
          mode: box
          step: 0.5
    helper_pause:
      name: Helper - pause between each dimming step
      description: How long should be delayed between each step of dimming in milliseconds.
        0 makes no delay. (10-2000)
      default: 500
      selector:
        number:
          min: 10.0
          max: 2000.0
          mode: box
          step: 10.0
mode: restart
max_exceeded: silent
variables:
  helper_transition_switch: !input helper_transition_switch
  helper_step_up: !input helper_step_up
  helper_step_down: !input helper_step_down
  helper_transition_dim: !input helper_transition_dim
  helper_pause: !input helper_pause
triggers:
- platform: mqtt
  topic: !input remote_topic
variables:
  command: '{{ trigger.payload_json.action }}'
conditions:
- condition: template
  value_template: '{{ command != ''''}}'
action:
- choose:
  - conditions:
    - '{{ command == ''on'' }}'
    sequence:
    - service: light.turn_on
      data:
        transition: !input helper_transition_switch
      target:
        entity_id: !input lights
  - conditions:
    - '{{ command == ''off'' }}'
    sequence:
    - service: light.turn_off
      data:
        transition: !input helper_transition_switch
      target:
        entity_id: !input lights
  - conditions:
    - '{{ command == ''toggle'' }}'
    sequence:
    - service: light.toggle
      data:
        transition: !input helper_transition_switch
      target:
        entity_id: !input lights
  - conditions:
    - '{{ command == ''brightness_move_up'' }}'
    sequence:
    - repeat:
        count: '20'
        sequence:
        - service: light.turn_on
          data:
            transition: !input helper_transition_dim
            brightness_step_pct: !input helper_step_up
          target:
            entity_id: !input lights
        - delay:
            hours: 0
            minutes: 0
            seconds: 0
            milliseconds: !input helper_pause
  - conditions:
    - '{{ command == ''brightness_move_down'' }}'
    sequence:
    - repeat:
        count: '20'
        sequence:
        - service: light.turn_on
          data:
            transition: !input helper_transition_dim
            brightness_step_pct: !input helper_step_down
          target:
            entity_id: !input lights
        - delay:
            hours: 0
            minutes: 0
            seconds: 0
            milliseconds: !input helper_pause
